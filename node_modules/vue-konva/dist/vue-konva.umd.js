(function(g,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue"),require("konva")):typeof define=="function"&&define.amd?define(["exports","vue","konva"],i):(g=typeof globalThis<"u"?globalThis:g||self,i(g["vue-konva"]={},g.Vue,g.Konva))})(this,function(g,i,h){"use strict";function v(a){if(!h.autoDrawEnabled){const o=a.getLayer()||a.getStage();o&&o.batchDraw()}}const N={key:!0,style:!0,elm:!0,isRootInsert:!0},_=".vue-konva-event";function k(a,o,c,e){const n=a.__konvaNode,d={};let r=!1;for(let t in c){if(N.hasOwnProperty(t))continue;const u=t.slice(0,2)==="on",f=c[t]!==o[t];if(u&&f){let l=t.slice(2).toLowerCase();l.slice(0,7)==="content"&&(l="content"+l.slice(7,1).toUpperCase()+l.slice(8)),n?.off(l+_,c[t])}!o.hasOwnProperty(t)&&n?.setAttr(t,void 0)}for(let t in o){if(N.hasOwnProperty(t))continue;let u=t.slice(0,2)==="on";const f=c[t]!==o[t];if(u&&f){let s=t.slice(2).toLowerCase();s.slice(0,7)==="content"&&(s="content"+s.slice(7,1).toUpperCase()+s.slice(8)),o[t]&&(n?.off(s+_),n?.on(s+_,o[t]))}!u&&(o[t]!==c[t]||e&&o[t]!==n?.getAttr(t))&&(r=!0,d[t]=o[t])}r&&n&&(n.setAttrs(d),v(n))}const T="v";function C(a){function o(c){return c?.__konvaNode?c:c?.parent?o(c.parent):(console.error("vue-konva error: Can not find parent node"),null)}return o(a.parent)}function S(a){return a.component?a.component.__konvaNode||S(a.component.subTree):null}function A(a){const{el:o,component:c}=a,e=S(a);if(o?.tagName&&c&&!e){const n=o.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${n}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return e}function E(a){const o=n=>!!n&&typeof n=="object"&&"component"in n,c=n=>Array.isArray(n),e=n=>o(n)?[n,...e(n.children)]:c(n)?n.flatMap(e):[];return e(a.children)}function P(a,o){const c=E(a),e=[];c.forEach(d=>{const r=A(d);r&&e.push(r)});let n=!1;e.forEach((d,r)=>{d.getZIndex()!==r&&(d.setZIndex(r),n=!0)}),n&&v(o)}const L=h.default?.Stage||h.Stage,b=i.defineComponent({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(a,{attrs:o,slots:c,expose:e}){const n=i.getCurrentInstance();if(!n)return;const d=i.reactive({}),r=i.ref(null),t=new L({width:a.config.width,height:a.config.height,container:document.createElement("div")});n.__konvaNode=t,s();function u(){return n?.__konvaNode}function f(){return n?.__konvaNode}function s(){if(!n)return;const l=d||{},y={...o,...a.config};k(n,y,l,a.__useStrictMode),Object.assign(d,y)}return i.onMounted(()=>{r.value&&(r.value.innerHTML="",t.container(r.value)),s()}),i.onUpdated(()=>{s(),P(n.subTree,t)}),i.onBeforeUnmount(()=>{t.destroy()}),i.watch(()=>a.config,s,{deep:!0}),e({getStage:f,getNode:u}),()=>i.h("div",{ref:r,style:o?.style},c.default?.())}}),O=".vue-konva-event",x={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function I(a,o){return i.defineComponent({name:a,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(c,{attrs:e,slots:n,expose:d}){const r=i.getCurrentInstance();if(!r)return;const t=i.reactive({}),u=new o;r.__konvaNode=u,r.vnode.__konvaNode=u,l();function f(){return r?.__konvaNode}function s(){return r?.__konvaNode}function l(){if(!r)return;const p={};for(const m in r?.vnode.props)m.slice(0,2)==="on"&&(p[m]=r.vnode.props[m]);const j=t||{},w={...e,...c.config,...p};k(r,w,j,c.__useStrictMode),Object.assign(t,w)}i.onMounted(()=>{const p=C(r)?.__konvaNode;p&&"add"in p&&p.add(u),v(u)}),i.onUnmounted(()=>{v(u),u.destroy(),u.off(O)}),i.onUpdated(()=>{l(),P(r.subTree,u)}),i.watch(()=>c.config,l,{deep:!0}),d({getStage:s,getNode:f});const y=x.hasOwnProperty(a);return()=>y?i.h("template",{},n.default?.()):null}})}function R(a,o,c){const e=i.ref(null),n=i.ref("loading"),d=(t,u,f)=>{n.value="loading";const s=new Image;u&&(s.crossOrigin=u),f&&(s.referrerPolicy=f),s.onload=()=>{e.value=s,n.value="loaded"},s.onerror=()=>{e.value=null,n.value="error"},s.src=t},r=i.computed(()=>({url:i.toValue(a),crossorigin:i.toValue(o),referrerPolicy:i.toValue(c)}));return i.watch(r,({url:t,crossorigin:u,referrerPolicy:f})=>{t&&d(t,u,f)},{immediate:!0}),[e,n]}const V={install:(a,o)=>{const c=o?.prefix||T,e=h.default||h,n={Arc:e.Arc,Arrow:e.Arrow,Circle:e.Circle,Ellipse:e.Ellipse,FastLayer:e.FastLayer,Group:e.Group,Image:e.Image,Label:e.Label,Layer:e.Layer,Line:e.Line,Path:e.Path,Rect:e.Rect,RegularPolygon:e.RegularPolygon,Ring:e.Ring,Shape:e.Shape,Sprite:e.Sprite,Star:e.Star,Tag:e.Tag,Text:e.Text,TextPath:e.TextPath,Transformer:e.Transformer,Wedge:e.Wedge,...o?.customNodes};[b,...Object.entries(n).map(([r,t])=>I(r,t))].forEach(r=>{a.component(`${c}${r.name}`,r)})}};g.default=V,g.useImage=R,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
